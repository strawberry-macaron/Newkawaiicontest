<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¯ã‚¤ã‚ºè¡¨ç¤ºç”»é¢</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>ã‚¯ã‚¤ã‚ºè¡¨ç¤ºç”»é¢</h1>

  <!-- å•é¡Œæ–‡ã¨ç­”ãˆ -->
  <div id="question-display">ï¼ˆå•é¡Œã¯ã¾ã è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“ï¼‰</div>

  <!-- ãƒœã‚¿ãƒ³ç¾¤ -->
  <button id="next-button">â–¶ï¸ æ¬¡ã¸</button>
  <button id="reset-button">ğŸ” ã‚¹ã‚³ã‚¢ãƒªã‚»ãƒƒãƒˆ</button> <!-- ğŸ”½ è¿½åŠ  -->

  <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚«ãƒ¼ãƒ‰ -->
  <div id="players"></div>

  <script>
    const bc = new BroadcastChannel("score_channel");
    const players = [];

    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¡¨ç¤ºï¼‹ã‚¹ã‚³ã‚¢æ›´æ–°å‡¦ç†
    bc.onmessage = (event) => {
      const data = event.data;

      if (data.type === "question") {
        const display = document.getElementById("question-display");
        display.innerHTML = `<strong>Q:</strong> ${data.q}<br><strong>A:</strong> ${data.a}`;
        return;
      }

      if (!players[data.index]) {
        players[data.index] = data;
        const container = document.getElementById("players");
        const div = document.createElement("div");
        div.id = `player-${data.index}`;
        div.className = `player ${data.color}`;
        div.innerHTML = `
          <h2>${data.name}</h2>
          <h4>${data.school}</h4>
          <div>${data.rank}ä½</div>
          <div class="score" id="score-${data.index}">0â—‹ 0Ã—</div>
          <div id="lose-${data.index}" style="color:red; font-weight:bold;"></div>
        `;
        container.appendChild(div);
      }

      // ã‚¹ã‚³ã‚¢æ›´æ–°
      document.getElementById(`score-${data.index}`).textContent =
        `${data.correct}â—‹ ${data.wrong}Ã—`;

      document.getElementById(`lose-${data.index}`).textContent =
        data.lose ? "LOSE" : "";
    };

    // æ¬¡ã¸ãƒœã‚¿ãƒ³
    document.getElementById("next-button").addEventListener("click", () => {
      let current = parseInt(localStorage.getItem("currentQuestionNumber") || "0");
      current += 1;
      localStorage.setItem("currentQuestionNumber", current.toString());
    });

    // ğŸ”½ ã‚¹ã‚³ã‚¢ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
    document.getElementById("reset-button").addEventListener("click", () => {
      for (let i = 0; i < players.length; i++) {
        if (!players[i]) continue;
        bc.postMessage({
          index: i,
          name: players[i].name,
          school: players[i].school,
          rank: players[i].rank,
          color: players[i].color,
          correct: 0,
          wrong: 0,
          lose: false
        });
      }
    });
  </script>
</body>
</html>
